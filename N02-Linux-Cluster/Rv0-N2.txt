#!/bin/bash

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <number_of_instances>"
    exit 1
fi

# Configuration Variables
N=$1  # Number of instances
BASE_NAME="ssh_cluster_"  # Base name for containers
SSH_KEY="$HOME/.ssh/id_rsa"  # Path to your SSH private key
SERVICE_NAME="rvo-ssh-service"
NETWORK_NAME="rvo-network"
IMAGE_NAME="rvo-ssh"

# Ensure SSH key exists
if [ ! -f "$SSH_KEY" ]; then
    echo "SSH key not found. Generating one..."
    ssh-keygen -t rsa -b 2048 -f "$SSH_KEY" -N ""
fi

# Build Docker image
echo "Building Docker image '$IMAGE_NAME'..."
docker build -t "$IMAGE_NAME" --build-arg SSH_KEY_PUB="$(cat "${SSH_KEY}.pub")" --build-arg SSH_KEY="$(cat "$SSH_KEY")" - <<EOF
FROM alpine:latest

ARG SSH_KEY_PUB
ARG SSH_KEY

RUN apk update && apk add --no-cache openssh-server pssh bash
RUN ssh-keygen -A

RUN mkdir -p /root/.ssh
RUN echo "\$SSH_KEY_PUB" > /root/.ssh/authorized_keys
RUN echo "\$SSH_KEY" > /root/.ssh/id_rsa
RUN echo "PermitRootLogin yes" >> /etc/ssh/sshd_config
RUN echo "PasswordAuthentication no" >> /etc/ssh/sshd_config

RUN chmod 700 /root/.ssh
RUN chmod 600 /root/.ssh/authorized_keys
RUN chmod 600 /root/.ssh/id_rsa

CMD ["/usr/sbin/sshd", "-D"]
EOF

# Initialize Docker Swarm if not already active
if ! docker info | grep -q "Swarm: active"; then
    echo "Initializing Docker Swarm..."
    docker swarm init
else
    echo "Docker Swarm is already active."
fi

# Create Docker network
echo "Creating Docker overlay network '$NETWORK_NAME'..."
docker network create --driver overlay --subnet 192.168.100.0/23 "$NETWORK_NAME" || echo "Network '$NETWORK_NAME' already exists."

# Deploy the service
echo "Deploying service '$SERVICE_NAME' with $N replicas..."
docker service create \
    --name "$SERVICE_NAME" \
    --replicas "$N" \
    --network "$NETWORK_NAME" \
    --publish published=2222,target=22 \
    "$IMAGE_NAME"

# Retrieve container IPs
echo "Retrieving container IPs..."
container_ips=$(docker network inspect "$NETWORK_NAME" --format '{{range .Containers}}{{.IPv4Address}} {{end}}' | awk '{$NF=""; sub(/[[:space:]]+$/, ""); print}')

# Run `pssh` in each container
echo "Running 'pssh' inside each container..."
container_ids=$(docker service ps "$SERVICE_NAME" --filter "desired-state=running" --format "{{.ID}}" | \
    xargs docker inspect --format '{{ .Status.ContainerStatus.ContainerID }}')



for container_id in $container_ids; do
    # Get the current container's IP address
    current_ip=$(docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}} {{end}}' "$container_id" | sed -E 's/^[^ ]+ //')
    
    # Filter out the current IP from the list of all IPs
    target_ips=$(echo "$container_ips" | tr '\n' ' ' | sed 's:/[0-9]*::g' | grep -v -w "$current_ip")

    # Debugging: Output the target IPs for validation
    echo "Current container: $current_ip"
    echo "Connecting to target hosts: $target_ips"

    # Execute `pssh` within the current container
    docker exec -it "$container_id" bash -c "
        echo 'Executing pssh to all other containers...';
        pssh -H \"$target_ips\" -x \"-o StrictHostKeyChecking=no\" 'hostname -i'
    "

    echo "Completed 'pssh' for container: $current_ip"
done

# Cleanup resources
echo "Removing Docker service '$SERVICE_NAME'..."
docker service rm "$SERVICE_NAME"

echo "Removing Docker network '$NETWORK_NAME'..."
docker network rm "$NETWORK_NAME"

echo "Removing Docker image '$IMAGE_NAME'..."
docker rmi -f "$IMAGE_NAME"

echo "Done!"

# izhod konzole:
simon@DESKTOP-VRKA5B1:/mnt/c/Users/simon/Desktop/RvO/N02-Linux-Cluster$ time bash RvO-N2.sh 20
Building Docker image 'rvo-ssh'...
[+] Building 0.3s (15/15) FINISHED                docker:default
 => [internal] load build definition from Dockerfile        0.1s
 => => transferring dockerfile: 531B                        0.0s
 => [internal] load .dockerignore                           0.1s
 => => transferring context: 2B                             0.0s
 => [internal] load metadata for docker.io/library/alpine:  0.0s
 => [ 1/11] FROM docker.io/library/alpine:latest            0.0s
 => CACHED [ 2/11] RUN apk update && apk add --no-cache op  0.0s
 => CACHED [ 3/11] RUN ssh-keygen -A                        0.0s
 => CACHED [ 4/11] RUN mkdir -p /root/.ssh                  0.0s
 => CACHED [ 5/11] RUN echo "ssh-rsa AAAAB3NzaC1yc2EAAAADA  0.0s
 => CACHED [ 6/11] RUN echo "-----BEGIN OPENSSH PRIVATE KE  0.0s
 => CACHED [ 7/11] RUN echo "PermitRootLogin yes" >> /etc/  0.0s
 => CACHED [ 8/11] RUN echo "PasswordAuthentication no" >>  0.0s
 => CACHED [ 9/11] RUN chmod 700 /root/.ssh                 0.0s
 => CACHED [10/11] RUN chmod 600 /root/.ssh/authorized_key  0.0s
 => CACHED [11/11] RUN chmod 600 /root/.ssh/id_rsa          0.0s
 => exporting to image                                     22.2s
 => => exporting layers                                     0.0s
 => => writing image sha256:1bb3b2ee7f6874161e1565c68f68c  22.1s
 => => naming to docker.io/library/rvo-ssh                  0.0s
WARNING: No blkio throttle.read_bps_device support
WARNING: No blkio throttle.write_bps_device support
WARNING: No blkio throttle.read_iops_device support
WARNING: No blkio throttle.write_iops_device support
WARNING: daemon is not using the default seccomp profile
Docker Swarm is already active.
Creating Docker overlay network 'rvo-network'...
21axs4hnps14y7gbj8az2ohxl
Deploying service 'rvo-ssh-service' with 20 replicas...
image rvo-ssh:latest could not be accessed on a registry to record
its digest. Each node will access rvo-ssh:latest independently,
possibly leading to different nodes running different
versions of the image.

9l06zkdt339grumoiti84um0k
overall progress: 20 out of 20 tasks
1/20: running
2/20: running
3/20: running
4/20: running
5/20: running
6/20: running
7/20: running
8/20: running
9/20: running
10/20: running
11/20: running
12/20: running
13/20: running
14/20: running
15/20: running
16/20: running
17/20: running
18/20: running
19/20: running
20/20: running
verify: Service converged
Retrieving container IPs...
Running 'pssh' inside each container...
Current container: 192.168.100.8
Connecting to target hosts:
Executing pssh to all other containers...
Completed 'pssh' for container: 192.168.100.8
Current container: 192.168.100.19
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:39 [SUCCESS] 192.168.100.14
[2] 22:32:39 [SUCCESS] 192.168.100.13
[3] 22:32:39 [SUCCESS] 192.168.100.10
[4] 22:32:39 [SUCCESS] 192.168.100.20
[5] 22:32:39 [SUCCESS] 192.168.100.18
[6] 22:32:39 [SUCCESS] 192.168.100.3
[7] 22:32:39 [SUCCESS] 192.168.100.9
[8] 22:32:39 [SUCCESS] 192.168.100.17
[9] 22:32:39 [SUCCESS] 192.168.100.4
[10] 22:32:39 [SUCCESS] 192.168.100.6
[11] 22:32:39 [SUCCESS] 192.168.100.11
[12] 22:32:39 [SUCCESS] 192.168.100.7
[13] 22:32:39 [SUCCESS] 192.168.100.22
[14] 22:32:39 [SUCCESS] 192.168.100.5
[15] 22:32:39 [SUCCESS] 192.168.100.16
[16] 22:32:39 [SUCCESS] 192.168.100.15
[17] 22:32:39 [SUCCESS] 192.168.100.21
[18] 22:32:39 [SUCCESS] 192.168.100.12
[19] 22:32:39 [SUCCESS] 192.168.100.8
[20] 22:32:39 [SUCCESS] 192.168.100.19
Completed 'pssh' for container: 192.168.100.19
Current container: 192.168.100.20
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:40 [SUCCESS] 192.168.100.3
[2] 22:32:40 [SUCCESS] 192.168.100.4
[3] 22:32:40 [SUCCESS] 192.168.100.17
[4] 22:32:40 [SUCCESS] 192.168.100.14
[5] 22:32:40 [SUCCESS] 192.168.100.18
[6] 22:32:40 [SUCCESS] 192.168.100.13
[7] 22:32:40 [SUCCESS] 192.168.100.15
[8] 22:32:40 [SUCCESS] 192.168.100.6
[9] 22:32:40 [SUCCESS] 192.168.100.7
[10] 22:32:40 [SUCCESS] 192.168.100.21
[11] 22:32:40 [SUCCESS] 192.168.100.9
[12] 22:32:40 [SUCCESS] 192.168.100.19
[13] 22:32:40 [SUCCESS] 192.168.100.20
[14] 22:32:40 [SUCCESS] 192.168.100.12
[15] 22:32:40 [SUCCESS] 192.168.100.11
[16] 22:32:40 [SUCCESS] 192.168.100.22
[17] 22:32:40 [SUCCESS] 192.168.100.16
[18] 22:32:40 [SUCCESS] 192.168.100.10
[19] 22:32:40 [SUCCESS] 192.168.100.5
[20] 22:32:41 [SUCCESS] 192.168.100.8
Completed 'pssh' for container: 192.168.100.20
Current container: 192.168.100.9
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:41 [SUCCESS] 192.168.100.20
[2] 22:32:41 [SUCCESS] 192.168.100.9
[3] 22:32:41 [SUCCESS] 192.168.100.7
[4] 22:32:41 [SUCCESS] 192.168.100.3
[5] 22:32:42 [SUCCESS] 192.168.100.15
[6] 22:32:42 [SUCCESS] 192.168.100.16
[7] 22:32:42 [SUCCESS] 192.168.100.21
[8] 22:32:42 [SUCCESS] 192.168.100.5
[9] 22:32:42 [SUCCESS] 192.168.100.19
[10] 22:32:42 [SUCCESS] 192.168.100.8
[11] 22:32:42 [SUCCESS] 192.168.100.10
[12] 22:32:42 [SUCCESS] 192.168.100.14
[13] 22:32:42 [SUCCESS] 192.168.100.17
[14] 22:32:42 [SUCCESS] 192.168.100.22
[15] 22:32:42 [SUCCESS] 192.168.100.11
[16] 22:32:42 [SUCCESS] 192.168.100.13
[17] 22:32:42 [SUCCESS] 192.168.100.12
[18] 22:32:42 [SUCCESS] 192.168.100.18
[19] 22:32:42 [SUCCESS] 192.168.100.4
[20] 22:32:42 [SUCCESS] 192.168.100.6
Completed 'pssh' for container: 192.168.100.9
Current container: 192.168.100.10
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:43 [SUCCESS] 192.168.100.3
[2] 22:32:43 [SUCCESS] 192.168.100.9
[3] 22:32:43 [SUCCESS] 192.168.100.15
[4] 22:32:43 [SUCCESS] 192.168.100.10
[5] 22:33:05 [SUCCESS] 192.168.100.20
[6] 22:32:43 [SUCCESS] 192.168.100.14
[7] 22:32:43 [SUCCESS] 192.168.100.13
[8] 22:32:43 [SUCCESS] 192.168.100.21
[9] 22:32:43 [SUCCESS] 192.168.100.5
[10] 22:32:43 [SUCCESS] 192.168.100.11
[11] 22:32:43 [SUCCESS] 192.168.100.16
[12] 22:32:43 [SUCCESS] 192.168.100.6
[13] 22:32:43 [SUCCESS] 192.168.100.4
[14] 22:32:43 [SUCCESS] 192.168.100.18
[15] 22:32:43 [SUCCESS] 192.168.100.17
[16] 22:32:43 [SUCCESS] 192.168.100.7
[17] 22:32:43 [SUCCESS] 192.168.100.22
[18] 22:32:43 [SUCCESS] 192.168.100.19
[19] 22:32:43 [SUCCESS] 192.168.100.12
[20] 22:32:43 [SUCCESS] 192.168.100.8
Completed 'pssh' for container: 192.168.100.10
Current container: 192.168.100.11
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:44 [SUCCESS] 192.168.100.18
[2] 22:32:44 [SUCCESS] 192.168.100.3
[3] 22:32:44 [SUCCESS] 192.168.100.20
[4] 22:32:44 [SUCCESS] 192.168.100.21
[5] 22:32:44 [SUCCESS] 192.168.100.9
[6] 22:32:44 [SUCCESS] 192.168.100.4
[7] 22:32:44 [SUCCESS] 192.168.100.11
[8] 22:32:44 [SUCCESS] 192.168.100.14
[9] 22:32:44 [SUCCESS] 192.168.100.6
[10] 22:32:44 [SUCCESS] 192.168.100.12
[11] 22:32:44 [SUCCESS] 192.168.100.13
[12] 22:32:44 [SUCCESS] 192.168.100.7
[13] 22:32:44 [SUCCESS] 192.168.100.10
[14] 22:32:44 [SUCCESS] 192.168.100.22
[15] 22:32:44 [SUCCESS] 192.168.100.17
[16] 22:32:44 [SUCCESS] 192.168.100.15
[17] 22:32:44 [SUCCESS] 192.168.100.8
[18] 22:32:44 [SUCCESS] 192.168.100.16
[19] 22:32:44 [SUCCESS] 192.168.100.19
[20] 22:32:44 [SUCCESS] 192.168.100.5
Completed 'pssh' for container: 192.168.100.11
Current container: 192.168.100.14
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:45 [SUCCESS] 192.168.100.13
[2] 22:32:45 [SUCCESS] 192.168.100.7
[3] 22:32:45 [SUCCESS] 192.168.100.20
[4] 22:32:45 [SUCCESS] 192.168.100.9
[5] 22:32:45 [SUCCESS] 192.168.100.18
[6] 22:32:45 [SUCCESS] 192.168.100.4
[7] 22:32:45 [SUCCESS] 192.168.100.21
[8] 22:32:45 [SUCCESS] 192.168.100.3
[9] 22:32:45 [SUCCESS] 192.168.100.6
[10] 22:32:45 [SUCCESS] 192.168.100.16
[11] 22:32:45 [SUCCESS] 192.168.100.12
[12] 22:32:45 [SUCCESS] 192.168.100.14
[13] 22:32:45 [SUCCESS] 192.168.100.11
[14] 22:32:45 [SUCCESS] 192.168.100.17
[15] 22:32:45 [SUCCESS] 192.168.100.10
[16] 22:32:45 [SUCCESS] 192.168.100.15
[17] 22:32:45 [SUCCESS] 192.168.100.5
[18] 22:32:45 [SUCCESS] 192.168.100.22
[19] 22:32:45 [SUCCESS] 192.168.100.19
[20] 22:32:45 [SUCCESS] 192.168.100.8
Completed 'pssh' for container: 192.168.100.14
Current container: 192.168.100.15
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:46 [SUCCESS] 192.168.100.18
[2] 22:32:46 [SUCCESS] 192.168.100.9
[3] 22:32:46 [SUCCESS] 192.168.100.11
[4] 22:32:46 [SUCCESS] 192.168.100.4
[5] 22:32:46 [SUCCESS] 192.168.100.16
[6] 22:32:46 [SUCCESS] 192.168.100.22
[7] 22:32:46 [SUCCESS] 192.168.100.14
[8] 22:32:46 [SUCCESS] 192.168.100.10
[9] 22:32:46 [SUCCESS] 192.168.100.13
[10] 22:32:46 [SUCCESS] 192.168.100.8
[11] 22:32:46 [SUCCESS] 192.168.100.15
[12] 22:32:46 [SUCCESS] 192.168.100.6
[13] 22:32:46 [SUCCESS] 192.168.100.7
[14] 22:32:46 [SUCCESS] 192.168.100.3
[15] 22:32:46 [SUCCESS] 192.168.100.20
[16] 22:32:46 [SUCCESS] 192.168.100.17
[17] 22:32:46 [SUCCESS] 192.168.100.12
[18] 22:32:46 [SUCCESS] 192.168.100.21
[19] 22:32:46 [SUCCESS] 192.168.100.19
[20] 22:32:47 [SUCCESS] 192.168.100.5
Completed 'pssh' for container: 192.168.100.15
Current container: 192.168.100.12
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:47 [SUCCESS] 192.168.100.14
[2] 22:32:47 [SUCCESS] 192.168.100.15
[3] 22:32:47 [SUCCESS] 192.168.100.11
[4] 22:32:47 [SUCCESS] 192.168.100.3
[5] 22:32:48 [SUCCESS] 192.168.100.5
[6] 22:32:48 [SUCCESS] 192.168.100.10
[7] 22:32:48 [SUCCESS] 192.168.100.13
[8] 22:32:48 [SUCCESS] 192.168.100.21
[9] 22:32:48 [SUCCESS] 192.168.100.9
[10] 22:32:48 [SUCCESS] 192.168.100.16
[11] 22:32:48 [SUCCESS] 192.168.100.19
[12] 22:32:48 [SUCCESS] 192.168.100.8
[13] 22:32:48 [SUCCESS] 192.168.100.18
[14] 22:32:48 [SUCCESS] 192.168.100.17
[15] 22:32:48 [SUCCESS] 192.168.100.20
[16] 22:32:48 [SUCCESS] 192.168.100.6
[17] 22:32:48 [SUCCESS] 192.168.100.4
[18] 22:32:48 [SUCCESS] 192.168.100.22
[19] 22:32:48 [SUCCESS] 192.168.100.12
[20] 22:33:10 [SUCCESS] 192.168.100.7
Completed 'pssh' for container: 192.168.100.12
Current container: 192.168.100.3
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:49 [SUCCESS] 192.168.100.18
[2] 22:32:49 [SUCCESS] 192.168.100.14
[3] 22:32:49 [SUCCESS] 192.168.100.11
[4] 22:32:49 [SUCCESS] 192.168.100.10
[5] 22:32:49 [SUCCESS] 192.168.100.13
[6] 22:32:49 [SUCCESS] 192.168.100.17
[7] 22:32:49 [SUCCESS] 192.168.100.6
[8] 22:32:49 [SUCCESS] 192.168.100.9
[9] 22:32:49 [SUCCESS] 192.168.100.7
[10] 22:32:49 [SUCCESS] 192.168.100.20
[11] 22:32:49 [SUCCESS] 192.168.100.3
[12] 22:32:49 [SUCCESS] 192.168.100.15
[13] 22:32:49 [SUCCESS] 192.168.100.21
[14] 22:32:49 [SUCCESS] 192.168.100.16
[15] 22:32:49 [SUCCESS] 192.168.100.4
[16] 22:32:49 [SUCCESS] 192.168.100.19
[17] 22:32:49 [SUCCESS] 192.168.100.12
[18] 22:32:49 [SUCCESS] 192.168.100.5
[19] 22:32:49 [SUCCESS] 192.168.100.22
[20] 22:32:49 [SUCCESS] 192.168.100.8
Completed 'pssh' for container: 192.168.100.3
Current container: 192.168.100.4
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:50 [SUCCESS] 192.168.100.11
[2] 22:32:50 [SUCCESS] 192.168.100.13
[3] 22:32:50 [SUCCESS] 192.168.100.10
[4] 22:32:50 [SUCCESS] 192.168.100.20
[5] 22:32:50 [SUCCESS] 192.168.100.9
[6] 22:32:50 [SUCCESS] 192.168.100.7
[7] 22:32:50 [SUCCESS] 192.168.100.19
[8] 22:32:50 [SUCCESS] 192.168.100.8
[9] 22:32:50 [SUCCESS] 192.168.100.6
[10] 22:32:50 [SUCCESS] 192.168.100.5
[11] 22:32:50 [SUCCESS] 192.168.100.14
[12] 22:32:50 [SUCCESS] 192.168.100.18
[13] 22:32:50 [SUCCESS] 192.168.100.16
[14] 22:32:50 [SUCCESS] 192.168.100.3
[15] 22:32:50 [SUCCESS] 192.168.100.21
[16] 22:32:50 [SUCCESS] 192.168.100.17
[17] 22:32:50 [SUCCESS] 192.168.100.4
[18] 22:32:50 [SUCCESS] 192.168.100.12
[19] 22:32:50 [SUCCESS] 192.168.100.15
[20] 22:32:50 [SUCCESS] 192.168.100.22
Completed 'pssh' for container: 192.168.100.4
Current container: 192.168.100.16
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:51 [SUCCESS] 192.168.100.9
[2] 22:32:51 [SUCCESS] 192.168.100.13
[3] 22:32:51 [SUCCESS] 192.168.100.5
[4] 22:32:51 [SUCCESS] 192.168.100.16
[5] 22:32:51 [SUCCESS] 192.168.100.21
[6] 22:32:51 [SUCCESS] 192.168.100.18
[7] 22:32:51 [SUCCESS] 192.168.100.17
[8] 22:32:51 [SUCCESS] 192.168.100.6
[9] 22:32:51 [SUCCESS] 192.168.100.4
[10] 22:32:51 [SUCCESS] 192.168.100.22
[11] 22:32:51 [SUCCESS] 192.168.100.7
[12] 22:32:51 [SUCCESS] 192.168.100.8
[13] 22:32:51 [SUCCESS] 192.168.100.14
[14] 22:32:51 [SUCCESS] 192.168.100.15
[15] 22:32:51 [SUCCESS] 192.168.100.19
[16] 22:32:51 [SUCCESS] 192.168.100.3
[17] 22:32:51 [SUCCESS] 192.168.100.11
[18] 22:32:51 [SUCCESS] 192.168.100.10
[19] 22:32:51 [SUCCESS] 192.168.100.20
[20] 22:32:51 [SUCCESS] 192.168.100.12
Completed 'pssh' for container: 192.168.100.16
Current container: 192.168.100.21
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:52 [SUCCESS] 192.168.100.6
[2] 22:32:52 [SUCCESS] 192.168.100.20
[3] 22:32:52 [SUCCESS] 192.168.100.18
[4] 22:32:52 [SUCCESS] 192.168.100.14
[5] 22:32:52 [SUCCESS] 192.168.100.7
[6] 22:32:52 [SUCCESS] 192.168.100.17
[7] 22:32:52 [SUCCESS] 192.168.100.13
[8] 22:32:53 [SUCCESS] 192.168.100.9
[9] 22:32:53 [SUCCESS] 192.168.100.5
[10] 22:32:53 [SUCCESS] 192.168.100.22
[11] 22:32:53 [SUCCESS] 192.168.100.3
[12] 22:32:53 [SUCCESS] 192.168.100.4
[13] 22:32:53 [SUCCESS] 192.168.100.10
[14] 22:32:53 [SUCCESS] 192.168.100.19
[15] 22:32:53 [SUCCESS] 192.168.100.11
[16] 22:32:53 [SUCCESS] 192.168.100.16
[17] 22:32:53 [SUCCESS] 192.168.100.8
[18] 22:32:53 [SUCCESS] 192.168.100.15
[19] 22:32:53 [SUCCESS] 192.168.100.21
[20] 22:32:53 [SUCCESS] 192.168.100.12
Completed 'pssh' for container: 192.168.100.21
Current container: 192.168.100.5
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:53 [SUCCESS] 192.168.100.9
[2] 22:32:54 [SUCCESS] 192.168.100.4
[3] 22:32:54 [SUCCESS] 192.168.100.6
[4] 22:32:54 [SUCCESS] 192.168.100.14
[5] 22:32:54 [SUCCESS] 192.168.100.15
[6] 22:32:54 [SUCCESS] 192.168.100.11
[7] 22:32:54 [SUCCESS] 192.168.100.13
[8] 22:32:54 [SUCCESS] 192.168.100.7
[9] 22:32:54 [SUCCESS] 192.168.100.20
[10] 22:32:54 [SUCCESS] 192.168.100.10
[11] 22:32:54 [SUCCESS] 192.168.100.18
[12] 22:32:54 [SUCCESS] 192.168.100.3
[13] 22:32:54 [SUCCESS] 192.168.100.17
[14] 22:32:54 [SUCCESS] 192.168.100.19
[15] 22:32:54 [SUCCESS] 192.168.100.16
[16] 22:32:54 [SUCCESS] 192.168.100.12
[17] 22:32:54 [SUCCESS] 192.168.100.8
[18] 22:32:54 [SUCCESS] 192.168.100.21
[19] 22:32:54 [SUCCESS] 192.168.100.22
[20] 22:32:54 [SUCCESS] 192.168.100.5
Completed 'pssh' for container: 192.168.100.5
Current container: 192.168.100.17
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:55 [SUCCESS] 192.168.100.20
[2] 22:32:55 [SUCCESS] 192.168.100.18
[3] 22:32:55 [SUCCESS] 192.168.100.14
[4] 22:32:55 [SUCCESS] 192.168.100.4
[5] 22:32:55 [SUCCESS] 192.168.100.11
[6] 22:32:55 [SUCCESS] 192.168.100.7
[7] 22:32:55 [SUCCESS] 192.168.100.17
[8] 22:32:55 [SUCCESS] 192.168.100.6
[9] 22:32:55 [SUCCESS] 192.168.100.13
[10] 22:32:55 [SUCCESS] 192.168.100.10
[11] 22:32:55 [SUCCESS] 192.168.100.3
[12] 22:32:55 [SUCCESS] 192.168.100.9
[13] 22:32:55 [SUCCESS] 192.168.100.15
[14] 22:32:55 [SUCCESS] 192.168.100.16
[15] 22:32:55 [SUCCESS] 192.168.100.22
[16] 22:32:55 [SUCCESS] 192.168.100.21
[17] 22:32:55 [SUCCESS] 192.168.100.5
[18] 22:32:55 [SUCCESS] 192.168.100.8
[19] 22:32:55 [SUCCESS] 192.168.100.12
[20] 22:32:55 [SUCCESS] 192.168.100.19
Completed 'pssh' for container: 192.168.100.17
Current container: 192.168.100.13
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:56 [SUCCESS] 192.168.100.10
[2] 22:32:56 [SUCCESS] 192.168.100.7
[3] 22:32:56 [SUCCESS] 192.168.100.3
[4] 22:32:56 [SUCCESS] 192.168.100.9
[5] 22:32:56 [SUCCESS] 192.168.100.5
[6] 22:32:56 [SUCCESS] 192.168.100.17
[7] 22:32:56 [SUCCESS] 192.168.100.11
[8] 22:32:56 [SUCCESS] 192.168.100.6
[9] 22:32:56 [SUCCESS] 192.168.100.4
[10] 22:32:56 [SUCCESS] 192.168.100.14
[11] 22:32:56 [SUCCESS] 192.168.100.20
[12] 22:32:56 [SUCCESS] 192.168.100.18
[13] 22:32:56 [SUCCESS] 192.168.100.22
[14] 22:32:56 [SUCCESS] 192.168.100.13
[15] 22:32:56 [SUCCESS] 192.168.100.16
[16] 22:32:56 [SUCCESS] 192.168.100.19
[17] 22:32:56 [SUCCESS] 192.168.100.8
[18] 22:32:56 [SUCCESS] 192.168.100.12
[19] 22:32:56 [SUCCESS] 192.168.100.15
[20] 22:32:56 [SUCCESS] 192.168.100.21
Completed 'pssh' for container: 192.168.100.13
Current container: 192.168.100.6
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:57 [SUCCESS] 192.168.100.11
[2] 22:32:57 [SUCCESS] 192.168.100.9
[3] 22:32:57 [SUCCESS] 192.168.100.10
[4] 22:32:57 [SUCCESS] 192.168.100.13
[5] 22:32:57 [SUCCESS] 192.168.100.3
[6] 22:32:57 [SUCCESS] 192.168.100.7
[7] 22:32:57 [SUCCESS] 192.168.100.18
[8] 22:32:57 [SUCCESS] 192.168.100.15
[9] 22:32:57 [SUCCESS] 192.168.100.5
[10] 22:32:57 [SUCCESS] 192.168.100.14
[11] 22:32:57 [SUCCESS] 192.168.100.4
[12] 22:32:57 [SUCCESS] 192.168.100.8
[13] 22:32:57 [SUCCESS] 192.168.100.17
[14] 22:32:57 [SUCCESS] 192.168.100.20
[15] 22:32:57 [SUCCESS] 192.168.100.19
[16] 22:32:57 [SUCCESS] 192.168.100.6
[17] 22:32:57 [SUCCESS] 192.168.100.16
[18] 22:32:57 [SUCCESS] 192.168.100.12
[19] 22:32:57 [SUCCESS] 192.168.100.21
[20] 22:32:57 [SUCCESS] 192.168.100.22
Completed 'pssh' for container: 192.168.100.6
Current container: 192.168.100.18
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:32:58 [SUCCESS] 192.168.100.7
[2] 22:32:58 [SUCCESS] 192.168.100.20
[3] 22:32:58 [SUCCESS] 192.168.100.6
[4] 22:32:58 [SUCCESS] 192.168.100.22
[5] 22:32:58 [SUCCESS] 192.168.100.17
[6] 22:32:58 [SUCCESS] 192.168.100.10
[7] 22:32:58 [SUCCESS] 192.168.100.13
[8] 22:32:58 [SUCCESS] 192.168.100.19
[9] 22:32:58 [SUCCESS] 192.168.100.4
[10] 22:32:59 [SUCCESS] 192.168.100.3
[11] 22:32:59 [SUCCESS] 192.168.100.21
[12] 22:32:59 [SUCCESS] 192.168.100.12
[13] 22:32:59 [SUCCESS] 192.168.100.5
[14] 22:32:59 [SUCCESS] 192.168.100.11
[15] 22:32:59 [SUCCESS] 192.168.100.18
[16] 22:32:59 [SUCCESS] 192.168.100.15
[17] 22:32:59 [SUCCESS] 192.168.100.16
[18] 22:32:59 [SUCCESS] 192.168.100.8
[19] 22:32:59 [SUCCESS] 192.168.100.9
[20] 22:32:59 [SUCCESS] 192.168.100.14
Completed 'pssh' for container: 192.168.100.18
Current container: 192.168.100.7
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:33:00 [SUCCESS] 192.168.100.20
[2] 22:33:00 [SUCCESS] 192.168.100.15
[3] 22:33:00 [SUCCESS] 192.168.100.9
[4] 22:33:00 [SUCCESS] 192.168.100.3
[5] 22:33:00 [SUCCESS] 192.168.100.13
[6] 22:33:00 [SUCCESS] 192.168.100.11
[7] 22:33:00 [SUCCESS] 192.168.100.6
[8] 22:33:00 [SUCCESS] 192.168.100.10
[9] 22:33:00 [SUCCESS] 192.168.100.16
[10] 22:33:00 [SUCCESS] 192.168.100.14
[11] 22:33:00 [SUCCESS] 192.168.100.17
[12] 22:33:00 [SUCCESS] 192.168.100.21
[13] 22:33:00 [SUCCESS] 192.168.100.22
[14] 22:33:00 [SUCCESS] 192.168.100.18
[15] 22:33:00 [SUCCESS] 192.168.100.4
[16] 22:33:00 [SUCCESS] 192.168.100.7
[17] 22:33:00 [SUCCESS] 192.168.100.8
[18] 22:33:00 [SUCCESS] 192.168.100.12
[19] 22:33:00 [SUCCESS] 192.168.100.5
[20] 22:33:00 [SUCCESS] 192.168.100.19
Completed 'pssh' for container: 192.168.100.7
Current container: 192.168.100.22
Connecting to target hosts: 192.168.100.11 192.168.100.10 192.168.100.14 192.168.100.3 192.168.100.9 192.168.100.20 192.168.100.18 192.168.100.13 192.168.100.6 192.168.100.17 192.168.100.7 192.168.100.4 192.168.100.15 192.168.100.16 192.168.100.21 192.168.100.22 192.168.100.19 192.168.100.5 192.168.100.12 192.168.100.8
Executing pssh to all other containers...
[1] 22:33:01 [SUCCESS] 192.168.100.11
[2] 22:33:01 [SUCCESS] 192.168.100.13
[3] 22:33:01 [SUCCESS] 192.168.100.20
[4] 22:33:01 [SUCCESS] 192.168.100.17
[5] 22:33:01 [SUCCESS] 192.168.100.15
[6] 22:33:01 [SUCCESS] 192.168.100.21
[7] 22:33:01 [SUCCESS] 192.168.100.7
[8] 22:33:01 [SUCCESS] 192.168.100.9
[9] 22:33:01 [SUCCESS] 192.168.100.4
[10] 22:33:01 [SUCCESS] 192.168.100.16
[11] 22:33:01 [SUCCESS] 192.168.100.14
[12] 22:33:01 [SUCCESS] 192.168.100.18
[13] 22:33:01 [SUCCESS] 192.168.100.5
[14] 22:33:01 [SUCCESS] 192.168.100.12
[15] 22:33:01 [SUCCESS] 192.168.100.8
[16] 22:33:01 [SUCCESS] 192.168.100.10
[17] 22:33:01 [SUCCESS] 192.168.100.3
[18] 22:33:01 [SUCCESS] 192.168.100.6
[19] 22:33:01 [SUCCESS] 192.168.100.22
[20] 22:33:01 [SUCCESS] 192.168.100.19
Completed 'pssh' for container: 192.168.100.22
Removing Docker service 'rvo-ssh-service'...
rvo-ssh-service
Removing Docker network 'rvo-network'...
rvo-network
Removing Docker image 'rvo-ssh'...
Untagged: rvo-ssh:latest
Done!

real    0m49.241s
user    0m2.074s
sys     0m1.569s